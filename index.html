<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnet de Vente (Thème Sombre)</title>
    <style>
        /* Couleurs pour le thème sombre */
        :root {
            --dark-bg: #1e1e1e;
            --dark-surface: #2d2d2d;
            --dark-border: #555;
            --light-text: #f0f0f0;
            --medium-text: #b0b0b0;
            --accent-green: #4CAF50;
            --accent-green-dark: #45a049;
        }

        body {
            font-family: sans-serif;
            margin-bottom: 80px; /* Add space at the bottom for the fixed button */
            padding: 20px; /* Add some padding around content */
            background-color: var(--dark-bg); /* Fond sombre */
            color: var(--light-text); /* Texte clair */
        }

        h1 {
            color: var(--light-text); /* Titre clair */
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
            border: 1px solid var(--dark-border); /* Bordure de table plus claire pour visibilité */
        }

        th, td {
            border: 1px solid var(--dark-border); /* Bordures de cellules plus claires */
            padding: 8px;
            text-align: left;
            color: var(--light-text); /* Texte clair dans les cellules */
            background-color: var(--dark-surface); /* Fond des cellules légèrement plus clair que le body */
        }

        th {
            background-color: #3a3a3a; /* Fond des en-têtes plus distinct */
            font-weight: bold;
        }

         /* Alternating row colors for better readability */
        tbody tr:nth-child(even) td {
            background-color: #333; /* Fond des lignes paires légèrement différent */
        }

        .total {
            font-weight: bold;
             background-color: #4a4a4a; /* Fond plus sombre pour la ligne total */
             color: var(--light-text);
        }

        /* Style for inputs and selects */
        input[type="number"],
        select {
            background-color: #444; /* Fond sombre pour les champs */
            color: var(--light-text); /* Texte clair dans les champs */
            border: 1px solid var(--dark-border); /* Bordure claire */
            padding: 5px;
            border-radius: 3px;
        }

        select option {
            background-color: #444; /* Fond sombre pour les options */
            color: var(--light-text); /* Texte clair pour les options */
        }


        /* Style for the button container */
        .button-container {
            position: fixed; /* Fixed position relative to the viewport */
            bottom: 20px;    /* 20px from the bottom */
            right: 20px;     /* 20px from the right */
            z-index: 1000;   /* Ensure it's above other content */
        }
        .button-container button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: var(--accent-green); /* Green */
            color: white; /* White text */
            border: none;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); /* Ombre plus visible sur fond sombre */
        }
        .button-container button:hover {
            background-color: var(--accent-green-dark); /* Darker green on hover */
        }

         /* Style for the date/time/check container */
         .info-container {
             margin-top: 10px;
             text-align: right;
             font-size: 0.9em;
             color: var(--medium-text); /* Texte gris moyen */
         }

         .info-container span {
             margin-left: 15px;
         }
    </style>
</head>
<body>
    <h1>Carnet de Vente</h1>

    <table>
        <thead>
            <tr>
                <th colspan="6">Carnet</th>
                <th colspan="1" id="salesperson-name">Aiden Wellington</th>
            </tr>
            <tr>
                <th>Catégorie</th>
                <th>Produit</th>
                <th>Prix de prod</th>
                <th>Prix de vente</th>
                <th>Quantité</th>
                <th>Montant</th>
                <th>Profit</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Nourriture</td>
                <td>
                    <select class="product-select" data-category="Nourriture">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Menu Huge Hunger" data-prod-price="29.5" data-sell-price="70">Menu Huge Hunger</option>
                        <option value="Menu Huge Thirsty" data-prod-price="27.5" data-sell-price="65">Menu Huge Thirsty</option>
                        <option value="Menu Bottle In The Sea" data-prod-price="21.25" data-sell-price="50">Menu Bottle In The Sea</option>
                        <option value="Menu Bloody" data-prod-price="20.5" data-sell-price="50">Menu Bloody</option>
                        <option value="Menu Morning" data-prod-price="11" data-sell-price="30">Menu Morning</option>
                        <option value="Burger Love" data-prod-price="17.5" data-sell-price="45">Burger Love</option>
                        <option value="Saignant" data-prod-price="15.5" data-sell-price="40">Saignant</option>
                        <option value="Arrêt du Coeur" data-prod-price="16.5" data-sell-price="45">Arrêt du Coeur</option>
                        <option value="Sandwitch Poisson" data-prod-price="9" data-sell-price="25">Sandwitch Poisson</option>
                        <option value="OneShot" data-prod-price="14.5" data-sell-price="35">OneShot</option>
                    </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
            <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
            <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
             <tr>
                <td>Boisson</td>
                <td>
                    <select class="product-select" data-category="Boisson">
                        <option value="" data-prod-price="0" data-sell-price="0">-- Sélectionner --</option>
                        <option value="Ramune Fraise" data-prod-price="5" data-sell-price="15">Ramune Fraise</option>
                        <option value="Ramune Limonade" data-prod-price="5" data-sell-price="15">Ramune Limonade</option>
                        <option value="Ramune Exotique" data-prod-price="5" data-sell-price="15">Ramune Exotique</option>
                        <option value="Bubble Tea CBD" data-prod-price="8" data-sell-price="20">Bubble Tea CBD</option>
                         <option value="Café" data-prod-price="0.5" data-sell-price="2">Café</option> <option value="Cidre Pression" data-prod-price="1" data-sell-price="5">Cidre Pression</option> </select>
                </td>
                <td class="product-prod-price"></td>
                <td class="product-sell-price"></td>
                <td><input type="number" class="quantity-input" value="0" min="0"></td>
                <td class="row-amount">$0.00</td>
                <td class="row-profit">$0.00</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4"></td>
                <td class="total">Total à facturer</td>
                <td id="total-amount" class="total">$0.00</td>
                <td id="total-profit" class="total">$0.00</td>
            </tr>
        </tfoot>
    </table>

    <div class="info-container">
        <span id="current-date"></span> <span id="current-time"></span> <span>✅</span>
    </div>

    <div class="button-container">
        <button id="validate-button">Valider la sélection</button>
    </div>

    <script>
        const productSelects = document.querySelectorAll('.product-select');
        const quantityInputs = document.querySelectorAll('.quantity-input');

        const totalAmountDisplay = document.getElementById('total-amount');
        const totalProfitDisplay = document.getElementById('total-profit');
        const validateButton = document.getElementById('validate-button');
        const salespersonNameElement = document.getElementById('salesperson-name');
        const currentDateElement = document.getElementById('current-date');
        const currentTimeElement = document.getElementById('current-time');


        function calculateRowAmount(row) {
            const productSelect = row.querySelector('.product-select');
            const quantityInput = row.querySelector('.quantity-input');
            const rowAmountDisplay = row.querySelector('.row-amount');
            const rowProfitDisplay = row.querySelector('.row-profit');
            const productProdPriceDisplay = row.querySelector('.product-prod-price');
            const productSellPriceDisplay = row.querySelector('.product-sell-price');

            const selectedOption = productSelect.options[productSelect.selectedIndex];
            const prodPrice = parseFloat(selectedOption.getAttribute('data-prod-price')) || 0;
            const sellPrice = parseFloat(selectedOption.getAttribute('data-sell-price')) || 0;
            const quantity = parseInt(quantityInput.value) || 0;

            const amount = sellPrice * quantity;
            const profit = (sellPrice - prodPrice) * quantity;

             // Update displayed prices only if a product is selected
            if (productSelect.value) {
                 productProdPriceDisplay.textContent = `$${prodPrice.toFixed(2)}`;
                 productSellPriceDisplay.textContent = `$${sellPrice.toFixed(2)}`;
            } else {
                 productProdPriceDisplay.textContent = ''; // Clear if no product selected
                 productSellPriceDisplay.textContent = ''; // Clear if no product selected
            }

            rowAmountDisplay.textContent = `$${amount.toFixed(2)}`;
            rowProfitDisplay.textContent = `$${profit.toFixed(2)}`;
        }

        function calculateTotal() {
            let totalAmount = 0;
             document.querySelectorAll('.row-amount').forEach(amountDisplay => { // Use querySelectorAll here to get current elements
                totalAmount += parseFloat(amountDisplay.textContent.replace('$', '')) || 0;
            });
            totalAmountDisplay.textContent = `$${totalAmount.toFixed(2)}`;

            let totalProfit = 0;
             document.querySelectorAll('.row-profit').forEach(profitDisplay => { // Use querySelectorAll here
                totalProfit += parseFloat(profitDisplay.textContent.replace('$', '')) || 0;
            });
            totalProfitDisplay.textContent = `$${totalProfit.toFixed(2)}`;
        }

        // Add event listeners for select and input changes
        productSelects.forEach((select) => {
            select.addEventListener('change', () => {
                calculateRowAmount(select.closest('tr'));
                calculateTotal();
            });
        });

        quantityInputs.forEach((input) => {
            input.addEventListener('input', () => {
                calculateRowAmount(input.closest('tr'));
                calculateTotal();
            });
        });

        // --- Google Sheets Integration Logic (Client-side data collection) ---

        validateButton.addEventListener('click', () => {
            const salesperson = salespersonNameElement.textContent.trim();
            const saleDate = currentDateElement.textContent.trim();
            const saleTime = currentTimeElement.textContent.trim();

            // Recalculate totals just before sending to ensure accuracy
            calculateTotal(); // Ensure totals are fresh

            const totalAmount = parseFloat(totalAmountDisplay.textContent.replace('$', '')) || 0;
            const totalProfit = parseFloat(totalProfitDisplay.textContent.replace('$', '')) || 0;

            // Check if there are any items selected with quantity > 0 or if total amount > 0
             const hasSelectedItems = Array.from(document.querySelectorAll('tbody tr')).some(row => {
                 const productSelect = row.querySelector('.product-select');
                 const quantityInput = row.querySelector('.quantity-input');
                 return productSelect.value && parseInt(quantityInput.value) > 0;
             });

             if (!hasSelectedItems && totalAmount <= 0) {
                 alert("Aucun article sélectionné avec une quantité supérieure à 0.");
                 return; // Prevent sending empty data
             }


            // Créer un objet avec les données de résumé à envoyer
            // Les clés doivent correspondre à celles attendues par votre script Google Apps Script
            const summaryDataToSend = {
                Date: saleDate,
                Heure: saleTime,
                Vendeur: salesperson,
                // Utilisez des noms de clés simples sans caractères spéciaux si possible pour l'échange JSON
                Chiffre_Affaire: totalAmount,
                Marge_Totale: totalProfit
                // NP, % Salaire, Salaire dû, Bénéfice Net seront gérés dans la feuille/Apps Script
            };

            console.log('Données sommaires à envoyer :', summaryDataToSend);

            // --- *** Placez l'URL déployée de votre Web App Google Apps Script ici *** ---
            // Important: Remplacez cette chaîne par l'URL réelle obtenue après le déploiement de votre script Apps Script.
            const googleSheetsUrl = 'https://script.google.com/macros/s/AKfycbzIZaXY4OmtqM4j67REJq1c9YbvGUnJZE2qgc2vfhIpRmD8v_dBK-IW09qaOB2s6n_OTw/exec';

            if (googleSheetsUrl === 'YOUR_APPS_SCRIPT_WEB_APP_URL') {
                 alert("Erreur de configuration : Veuillez remplacer 'YOUR_APPS_SCRIPT_WEB_APP_URL' dans le script par l'URL de votre Web App Google Apps Script.");
                 return; // Stop if URL is not set
            }


            // --- Send data to Google Apps Script Web App ---
            fetch(googleSheetsUrl, {
                method: 'POST',
                mode: 'no-cors', // Utilisez 'no-cors' pour éviter les problèmes de CORS, limite la gestion des réponses.
                headers: {
                    'Content-Type': 'application/json'
                    // Note sur no-cors et headers: Voir commentaire dans le code Apps Script si besoin.
                },
                body: JSON.stringify(summaryDataToSend) // Envoyez l'objet JSON résumé
            })
            .then(response => {
                 console.log('Réponse reçue (mode no-cors, réponse opaque):', response);
                 // En mode no-cors, on ne peut pas lire le statut HTTP ni le corps de la réponse directement en JS.
                 // On assume généralement le succès si le 'fetch' ne déclenche pas d'erreur réseau.
                 alert('Sélection validée. Données envoyées à Google Sheets (vérifiez la feuille pour confirmation) !');

                 // Optional: Clear the form after assumed successful submission
                 document.querySelectorAll('.quantity-input').forEach(input => input.value = 0);
                 document.querySelectorAll('.product-select').forEach(select => select.value = '');
                 document.querySelectorAll('tbody tr').forEach(row => calculateRowAmount(row)); // Recalculate row amounts to reset displays
                 calculateTotal(); // Recalculate totals to show $0.00
                 // Update date and time for the next transaction
                 updateDateTime();

            })
            .catch((error) => {
                console.error('Erreur lors de l\'envoi des données:', error);
                alert('Échec de l\'envoi des données. Vérifiez la console, la configuration Apps Script et l\'URL.');
            });
        });

        // Function to update date and time
        function updateDateTime() {
             const now = new Date();
             const day = String(now.getDate()).padStart(2, '0');
             const month = String(now.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
             const year = now.getFullYear();
             const hours = String(now.getHours()).padStart(2, '0');
             const minutes = String(now.getMinutes()).padStart(2, '0');
             const seconds = String(now.getSeconds()).padStart(2, '0');

             currentDateElement.textContent = `${day}/${month}/${year}`;
             currentTimeElement.textContent = `${hours}:${minutes}:${seconds}`;
        }


        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Calculate initial values based on default selections/quantities
            document.querySelectorAll('tbody tr').forEach(row => {
                calculateRowAmount(row);
            });
            calculateTotal();
            // Set the current date and time
            updateDateTime();
        });
    </script>
</body>
</html>
